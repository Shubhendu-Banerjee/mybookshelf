<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="{{ url_for('static', filename='autocomplete.js') }}"></script>
</head>
<body>
  <button class="toggle-container" onclick="toggleDarkMode()">ðŸŒ“ Toggle Dark Mode</button>

  <div class="dashboard-container">
    <h2>ðŸ“š Your Book Dashboard</h2>

    <form method="POST" action="/add">
      <label>
        Title:
        <input name="title" id="titleInput" autocomplete="off">
      </label>    

      <label>
        Author:
        <input name="author">
      </label>

      <label>
        Genre:
        <input name="genre">
      </label>

      <label>
        Status:
        <select name="status" id="statusSelect">
          <option>To Read</option>
          <option>Reading</option>
          <option>Read</option>
        </select>
      </label>

      <label id="currentPageLabel">
        Current Page:
        <input type="number" name="current_page" id="currentPageInput" min="0" value="0">
      </label>
      
      <input type="hidden" name="google_books_id">
      <input type="hidden" name="thumbnail_url">

      <button type="submit">Add Book</button>
    </form>

    <h3>Your Books</h3>
    <ul>
      {% for book in books %}
        <li>
          {% if book[8] %}
            <img src="{{ book[8] }}" alt="Cover" class="thumbnail">
          {% endif %}
          <div>
            <strong>{{ book[2] }}</strong> by {{ book[3] }} ({{ book[5] }}) â€” 
            {% if book[6] is not none and book[6] > 0 %}
              Current Page: {{ book[6] }}
            {% else %}
              No page recorded
            {% endif %}
          </div>
          <a href="/delete/{{ book[0] }}">Delete</a>
        </li>
      {% endfor %}
    </ul>


    <div style="text-align:center; margin-top: 20px;">
      <a href="/logout">Logout</a>
    </div>
  </div>

  <script>
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    // Persist user preference
    window.onload = () => {
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
      }
      
      // Initialize the status/current page logic on load
      handleStatusChange();
    };

    const statusSelect = document.getElementById('statusSelect');
    const currentPageInput = document.getElementById('currentPageInput');
    const currentPageLabel = document.getElementById('currentPageLabel');

    function handleStatusChange() {
      if (statusSelect.value === 'Reading') {
        currentPageInput.disabled = false;
        currentPageInput.required = true; // Make it required when 'Reading'
        currentPageLabel.style.opacity = '1';
        currentPageLabel.style.pointerEvents = 'auto';
      } else {
        currentPageInput.disabled = true;
        currentPageInput.required = false; // Not required when disabled
        currentPageInput.value = 0; // Reset value when disabled
        currentPageLabel.style.opacity = '0.5'; // Visually indicate disabled
        currentPageLabel.style.pointerEvents = 'none'; // Prevent interaction
      }
    }

    statusSelect.addEventListener('change', handleStatusChange);
  </script>

</body>
</html>